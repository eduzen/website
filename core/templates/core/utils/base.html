{% load i18n static %}

{% get_current_language as LANGUAGE_CODE %}

<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">

  <head>
    {% block head %}
      {% include 'core/utils/head.html' %}
    {% endblock head %}
  </head>

  <body hx-headers='{"x-csrftoken": "{{ csrf_token }}"}' class="bg-slate-800 text-gray-100 font-mono flex flex-col min-h-screen">
    {% block navbar %}
      {% include "core/utils/navbar.html" %}
    {% endblock navbar %}

    <main id="content" class="flex-grow pt-16 p-4 sm:p-6 md:p-8 lg:p-10 xl:p-20">

      {% block content %}{% endblock %}
    </main>

    {% block footer %}
      {% include "core/utils/footer.html" %}
    {% endblock footer %}

    {% block extra_scripts %}
      {# Moved to core/static/core/js #}
      <script src="{% static 'core/js/menu.js' %}"></script>
      <script src="{% static 'core/js/colorize.js' %}"></script>
      <script async defer data-domain="eduzen.ar" src="https://stats.eduzen.ar/js/plausible.js"></script>

      <script>
        // Global HTMX configuration and event handlers
        document.addEventListener('DOMContentLoaded', function() {
          // Show loading indicator on HTMX requests
          document.body.addEventListener('htmx:beforeRequest', function(evt) {
            const indicator = document.getElementById('loadingIndicator');
            if (indicator) {
              indicator.classList.remove('scale-x-0');
              indicator.classList.add('scale-x-100');
            }
          });

          // Hide loading indicator when request completes
          document.body.addEventListener('htmx:afterRequest', function(evt) {
            const indicator = document.getElementById('loadingIndicator');
            if (indicator) {
              setTimeout(() => {
                indicator.classList.remove('scale-x-100');
                indicator.classList.add('scale-x-0');
              }, 200);
            }
          });

          // Handle HTMX errors
          document.body.addEventListener('htmx:responseError', function(evt) {
            console.error('HTMX Request failed:', evt.detail);
            const indicator = document.getElementById('loadingIndicator');
            if (indicator) {
              indicator.classList.remove('scale-x-100', 'bg-blue-500');
              indicator.classList.add('scale-x-0', 'bg-red-500');
              setTimeout(() => {
                indicator.classList.remove('bg-red-500');
                indicator.classList.add('bg-blue-500');
              }, 2000);
            }
          });
        });
      </script>
    {% endblock extra_scripts %}
  </body>
</html>
